<div class="container">
  <div class="row">
    <div class="col s12">
      <h1>과제 목록</h1>
      <select id="title" name="title">
        <option value="" disabled selected>과제를 선택하세요</option>
        <% AssignmentTitle.all.each do |item| %>
          <option value="<%= item.name %>"><%= item.name %></option>
        <% end %>
      </select>
      <p id="assign_description"></p>
    </div>
    <div class="col s12">
      <div id="wrapper">
        <div id="columns">
              <% @test_assigntitle.assignments.each do |assign| %>
                    <div class="pin">
                        <h1><%= assign.user_assignments.find_by(submition: true).user.name%></h1>
                        <p><%= assign.comment %></p>
                        <a href="<%= asset_path(assign.img) %>" class="fancybox"><img src="<%= asset_path(assign.img) %>"></a>
                        <a style="font-size:50%"href="<%=assign.git_url%>"><%=assign.git_url%></a><br>
                        <% if current_user.id==1 || current_user.id==assign.user_assignments.find_by(submition: true).user.id%>
                        <a href="/assignment/assign_delete?value=<%= assign.id%>&title=<%=assign.title%>" style="text_align:center;">삭제</a>
                        <% end %>
                      </div>
              <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function() {
    $('.fancybox').fancybox();
    $('select').material_select();
    
 $('#title').change(function(){
    $.ajax({
      url: '/assignment/get_board_info',
      dataType: 'json',
      data: {
        title: $(this).val()
      },
      success: function(data){
        $("#columns").empty(); 
        $('#assign_description').text(data.desc);

        for(i=0; i<data.assign.length; i++) {
        if(data.user_id==1 ||data.user[i].id==data.user_id){
        $('#columns').append('<div class="pin"><h1>'+data.user[i].name+'</h1><p>'+
                          data.assign[i].comment+'</p>'+'<a href="'+data.img[i]+
                          '" class="fancybox"><img src="'+data.img[i]+
                          '"></a>'+'<a style="font-size:50%"href="'+
                          data.assign[i].git_url+'">'+data.assign[i].git_url+
                          '</a><br><a href="/assignment/assign_delete?value='+
                          data.assign[i].id+'&title='+data.assign[i].title+'">삭제</a></div>');
        }
        else{
          $('#columns').append('<div class="pin"><h1>'+data.user[i].name+'</h1><p>'+
                          data.assign[i].comment+'</p>'+'<a href="'+data.img[i]+
                          '" class="fancybox"><img src="'+data.img[i]+
                          '"></a>'+'<a style="font-size:50%"href="'+
                          data.assign[i].git_url+'">'+data.assign[i].git_url+
                          '</a><br></div>');
        }
        }
      },
      error: function(){
        $('#assign_description').text("에러가 발생했습니다");
      }
    });
  });
});
</script>